---
title: "Medical Cost Analysis"
output: 
  flexdashboard::flex_dashboard:
    orientation: row 
    vertical_layout: fill
    self_contained: no
---

```{r setup, include=FALSE}
library(flexdashboard)
library(plyr)
library(knitr)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DAAG)
```

```{r}
insurance <- read.csv("~/Downloads/insurance.csv")
insuranceFrame <- as.data.frame(insurance)
```

Mean / Deviation 
================================================
row
-----------------------------------------------------------------------
### Mean Charges (No Children)

```{r}
insuranceNoChildren <- insuranceFrame[grepl(0, insuranceFrame$children),]
valueBox(round(mean(insuranceNoChildren$charges),2)) # $12365.98
```

### SD Charges(No Children)

```{r}
valueBox(round(sd(insuranceNoChildren$charges), 2)) # 12023.29 
```

### Mean Charges (With Children)

```{r}
insuranceChildrenTotal <- insuranceFrame[!grepl(0, insuranceFrame$children),]
valueBox(round(mean(insuranceChildrenTotal$charges),2)) # $13949.94
```

### SD Charges (With Children)
```{r}
valueBox(round(sd(insuranceChildrenTotal$charges),2)) # 12138.31
```

column
-----------------------------------------------------------------------

```{r}
CostCompare <- ddply(insuranceFrame,~children,summarise,CostAvg=mean((charges)))
```

### Averages
```{r}
plot1 <- ggplot(CostCompare, aes(x=children, y=CostAvg)) +
  geom_bar(position="dodge", stat="identity", fill = "red4") + ggtitle("Average Charges by Child Number") + 
  ylab("Charges Applied") + xlab("# Children") + 
  geom_text(aes(label=round(CostAvg,1)), position = position_dodge(width=1), vjust=-.25) + theme_bw()
plot1 + theme(plot.title = element_text(hjust = .5), legend.position = "none")
```

### Deviation Plot
```{r}
#Generate Deviation Plot
CostCompare$Norm <- round((CostCompare$CostAvg - 
                            mean(CostCompare$CostAvg)) / sd(CostCompare$CostAvg), 2)
#Check to see if the values are below or above 0
CostCompare$aboveBelow <- ifelse(CostCompare$Norm < 0, "below", "above")
CostCompare <- CostCompare[order(CostCompare$Norm),]
CostCompare$children <- factor(CostCompare$children, levels = CostCompare$children)

plot2 <-ggplot(CostCompare, aes(x=children, y=Norm, label=Norm)) +
  geom_bar(stat='identity', aes(fill=aboveBelow), width=.5)  +
  scale_fill_manual(name="Deviation of Charges", 
                    labels = c("Above Average", "Below Average"), 
                    values = c("above"="cyan3", "below"="orangered1")) + 
  ylab("Deviation From Mean") + xlab("Number of Children") +
  labs(title= "Average Charge Deviation by Child") + coord_flip() + theme_bw()
plot2 + theme(plot.title = element_text(hjust = .5),
              axis.text.x = element_text(angle=35, vjust=0.6))
```

Regression 
==================================================
```{r}
M2 <- lm(insurance$charges ~ insurance$age + insurance$children + insurance$bmi + 
             insurance$smoker, insurance)
```

row
--------------------------------------------------
### BIC
```{R}
valueBox(BIC(M2))
```

### AIC
```{R}
valueBox(AIC(M2))
```

row
-------------------------------------------------

### There should be an image under me 
![ALT text](/Users/nick/Desktop/R/Insurance Cost/box.png)

### Regression plots
```{r}
plot(M2)
```
